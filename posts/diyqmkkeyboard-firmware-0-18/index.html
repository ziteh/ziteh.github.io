<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/uploads/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/uploads/site.webmanifest">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300italic,400,400italic,700,700italic%7CNoto+Sans+TC:300,300italic,400,400italic,700,700italic%7CFira+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ziteh.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":true,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"${hits} 找到 ${time} 個結果","hits":"找到 ${hits} 個結果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="⚠ 由於最新的 0.21.3 版本的 QMK 在使用上的差異滿大的，這篇是針對舊版 0.18.3 的 QMK 教學，僅作爲參考保留。 最新版的 QMK 教學。">
<meta property="og:type" content="article">
<meta property="og:title" content="[自製QMK鍵盤-番外] 0.18.3版QMK韌體教學">
<meta property="og:url" content="https://ziteh.github.io/posts/diyqmkkeyboard-firmware-0-18/index.html">
<meta property="og:site_name" content="ZiTe 本物志">
<meta property="og:description" content="⚠ 由於最新的 0.21.3 版本的 QMK 在使用上的差異滿大的，這篇是針對舊版 0.18.3 的 QMK 教學，僅作爲參考保留。 最新版的 QMK 教學。">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://1.bp.blogspot.com/-UTbRymD6jFo/Xu4uCFUmN4I/AAAAAAAACc4/Pun-2kS6qooDb3plao7F_e5sogqH_uHKQCK4BGAsYHg/s1903/%255B01%255DKeyboard%2BFirmware%2BBuilder_Import.png">
<meta property="og:image" content="https://1.bp.blogspot.com/-9pJYrEjmaXU/Xu4uCdp4PEI/AAAAAAAACc8/p8MMZuiSBUMSpTjsN0f0Xa78Turt48kzwCK4BGAsYHg/s1903/%255B02%255DKeyboard%2BFirmware%2BBuilder_Wiring_1.png">
<meta property="og:image" content="https://1.bp.blogspot.com/-Bx4OSDytWs8/Xu4uCq9KkdI/AAAAAAAACdA/8d4QLa2qTHMMXBS1Z6Fvma_u-Q5Ud22cgCK4BGAsYHg/s800/%255B03%255DKeyboard%2BFirmware%2BBuilder_Wiring_2.png">
<meta property="og:image" content="https://1.bp.blogspot.com/-3_lDlu5GoMI/Xu4uCxknlCI/AAAAAAAACdE/4pwTfeQGe8cw8LW-L2a26VXxSf20eA3nwCK4BGAsYHg/s826/%255B04%255DKeyboard%2BFirmware%2BBuilder_Pins.png">
<meta property="og:image" content="https://1.bp.blogspot.com/-UqmjvTbo7Uo/Xu4yajqMXKI/AAAAAAAACeE/AEfdjtlknrcRsjSYvmRz5B0IxY4RIiQegCK4BGAsYHg/s1166/ProMicroPin.png">
<meta property="og:image" content="https://1.bp.blogspot.com/-bWzQzPwFGgI/Xu4uDJhvouI/AAAAAAAACdI/UTgEK0bLZWgvv2Sl1gTl3mLlCnSgn_RbACK4BGAsYHg/s1903/%255B05%255DKeyboard%2BFirmware%2BBuilder_Keymap_1.png">
<meta property="og:image" content="https://1.bp.blogspot.com/-AXyTVOereYY/Xu4uDQIikrI/AAAAAAAACdM/ZKoLu2A_TsMjSCcAAJVC_-EHaGEJ9w3agCK4BGAsYHg/s800/%255B06%255DKeyboard%2BFirmware%2BBuilder_Keymap_2.png">
<meta property="og:image" content="https://1.bp.blogspot.com/-d9DCcztZXjQ/Xu4uD44T8EI/AAAAAAAACdQ/Zq8zndxEDWsZRd3Qud_NiWASE6bDZVgkwCK4BGAsYHg/s1903/%255B07%255DKeyboard%2BFirmware%2BBuilder_Keymap_3.png">
<meta property="og:image" content="https://1.bp.blogspot.com/-6UmwdSv5mYk/Xu4uEFGPrgI/AAAAAAAACdU/QbZ_V0elfsM458VOkhnI7aTYoktUyzVBACK4BGAsYHg/s800/%255B08%255DKeyboard%2BFirmware%2BBuilder_Macros.png">
<meta property="og:image" content="https://1.bp.blogspot.com/-3JK9VPepotg/Xu4uEYvZriI/AAAAAAAACdY/I4z4ycD-A_YLnDOm35iWjq46P1dw1WPPQCK4BGAsYHg/s800/%255B09%255DKeyboard%2BFirmware%2BBuilder_Quantum.png">
<meta property="og:image" content="https://1.bp.blogspot.com/-Vdfp-gzx0uQ/Xu4uEo34ilI/AAAAAAAACdc/sRvlviZR_xUQEhy6Ma0oLsFQ9c_OW50hgCK4BGAsYHg/s800/%255B10%255DKeyboard%2BFirmware%2BBuilder_Settings.png">
<meta property="og:image" content="https://1.bp.blogspot.com/-IbmnNoxPZ-s/Xu4uE8BFvvI/AAAAAAAACdg/khQpXPgiygkaVn409H394FOvf9RN8C-iACK4BGAsYHg/s800/%255B11%255DKeyboard%2BFirmware%2BBuilder_Compile.png">
<meta property="article:published_time" content="2023-04-21T06:48:00.000Z">
<meta property="article:modified_time" content="2024-06-22T08:56:19.874Z">
<meta property="article:author" content="ZiTe">
<meta property="article:tag" content="DIY">
<meta property="article:tag" content="教學">
<meta property="article:tag" content="QMK">
<meta property="article:tag" content="3C">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://1.bp.blogspot.com/-UTbRymD6jFo/Xu4uCFUmN4I/AAAAAAAACc4/Pun-2kS6qooDb3plao7F_e5sogqH_uHKQCK4BGAsYHg/s1903/%255B01%255DKeyboard%2BFirmware%2BBuilder_Import.png">


<link rel="canonical" href="https://ziteh.github.io/posts/diyqmkkeyboard-firmware-0-18/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-TW","comments":true,"permalink":"https://ziteh.github.io/posts/diyqmkkeyboard-firmware-0-18/","path":"posts/diyqmkkeyboard-firmware-0-18/","title":"[自製QMK鍵盤-番外] 0.18.3版QMK韌體教學"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>[自製QMK鍵盤-番外] 0.18.3版QMK韌體教學 | ZiTe 本物志</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ZiTe 本物志</p>
      <i class="logo-line"></i>
      <p class="site-subtitle" itemprop="description">一位慢步於程式、電路與文學之人的學習記錄與分享</p>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜尋" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-folder-open fa-fw"></i>分類</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%87%AA%E5%8B%95%E7%94%A2%E7%94%9F%E9%9F%8C%E9%AB%94"><span class="nav-text">自動產生韌體</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%80%E5%85%A5%E9%8D%B5%E7%9B%A4"><span class="nav-text">讀入鍵盤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A5%E7%B7%9A%EF%BC%88wiring%EF%BC%89"><span class="nav-text">接線（Wiring）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%85%B3%E4%BD%8D%EF%BC%88pins%EF%BC%89"><span class="nav-text">腳位（Pins）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%8D%B5%E6%98%A0%E5%B0%84%EF%BC%88keymap%EF%BC%89"><span class="nav-text">鍵映射（Keymap）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A8%E9%9B%86%E9%8D%B5%EF%BC%88macros%EF%BC%89"><span class="nav-text">巨集鍵（Macros）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#quantum"><span class="nav-text">Quantum</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A8%AD%E5%AE%9A%EF%BC%88settings%EF%BC%89"><span class="nav-text">設定（Settings）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B7%A8%E8%AD%AF%EF%BC%88compile%EF%BC%89"><span class="nav-text">編譯（Compile）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%8B%E5%8B%95%E7%B7%A8%E8%BC%AF%E9%9F%8C%E9%AB%94"><span class="nav-text">手動編輯韌體</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9-rules-mk"><span class="nav-text">修改 rules.mk</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E6%8E%A7%E5%88%B6%E5%99%A8%E5%9E%8B%E8%99%9F"><span class="nav-text">微控制器型號</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E6%8E%A7%E5%88%B6%E5%99%A8%E9%A0%BB%E7%8E%87"><span class="nav-text">微控制器頻率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%81%B8%E6%93%87-bootloader"><span class="nav-text">選擇 Bootloader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E5%8A%9F%E8%83%BD"><span class="nav-text">其它功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%AE%8C%E6%88%90"><span class="nav-text">修改完成</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9-config-h"><span class="nav-text">修改 config.h</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9-usb-%E8%B3%87%E8%A8%8A"><span class="nav-text">修改 USB 資訊</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%85%B3%E4%BD%8D"><span class="nav-text">修改腳位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%8D%B5%E7%9B%A4%E7%9F%A9%E9%99%A3%E5%A4%A7%E5%B0%8F"><span class="nav-text">鍵盤矩陣大小</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B2%E5%BD%88%E8%B7%B3"><span class="nav-text">防彈跳</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E5%AE%83"><span class="nav-text">其它</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%AE%8C%E6%88%90-1"><span class="nav-text">修改完成</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9-keymap-c"><span class="nav-text">修改 keymap.c</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%AA%E9%99%A4-even"><span class="nav-text">刪除 even</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%94%B9%E6%8C%89%E9%8D%B5%E6%98%A0%E5%B0%84"><span class="nav-text">改按鍵映射</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B5%90%E8%AA%9E"><span class="nav-text">結語</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%B8%E9%97%9C%E7%B6%B2%E7%AB%99%E5%8F%8A%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99"><span class="nav-text">相關網站及參考資料</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <a href="/about/" title="About">
      <img class="site-author-image" itemprop="image" alt="ZiTe"
        src="/uploads/avatar.png">
    <p class="site-author-name" itemprop="name">ZiTe</p>
    <div class="site-description" itemprop="description"></div>
  </a>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ziteh" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ziteh" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.youtube.com/@siderakb" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;@siderakb" rel="noopener me" target="_blank"><i class="fab fa-youtube fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://siderakb.github.io/" title="SideraKB → https:&#x2F;&#x2F;siderakb.github.io&#x2F;" rel="noopener me" target="_blank"><i class="fa fa-keyboard fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:honmonoh@gmail.com" title="E-Mail → mailto:honmonoh@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="回到頂端">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://ziteh.github.io/posts/diyqmkkeyboard-firmware-0-18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="ZiTe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZiTe 本物志">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="[自製QMK鍵盤-番外] 0.18.3版QMK韌體教學 | ZiTe 本物志">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
          
          <div class="post-tags">
              <a href="/tags/DIY/" rel="tag"> DIY</a>
              <a href="/tags/%E6%95%99%E5%AD%B8/" rel="tag"> 教學</a>
              <a href="/tags/QMK/" rel="tag"> QMK</a>
              <a href="/tags/3C/" rel="tag"> 3C</a>
          </div>

        <h1 class="post-title" itemprop="name headline">
          [自製QMK鍵盤-番外] 0.18.3版QMK韌體教學
        </h1>
          <h3 class="post-subtitle">2022 QMK 韌體教學
          </h3>


        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%87%AA%E8%A3%BDQMK%E9%8D%B5%E7%9B%A4/" itemprop="url" rel="index"><span itemprop="name">自製QMK鍵盤</span></a>
        </span>
    </span>
    <span class="post-meta-item">
      
      

      <time title="創建時間：2023-04-21 14:48:00" itemprop="dateCreated datePublished" datetime="2023-04-21T14:48:00+08:00">2023-04-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>⚠ 由於最新的 <a target="_blank" rel="noopener" href="https://github.com/qmk/qmk_firmware/releases/tag/0.21.3"><code>0.21.3</code></a> 版本的 QMK 在使用上的差異滿大的，這篇是針對舊版 <a target="_blank" rel="noopener" href="https://github.com/qmk/qmk_firmware/releases/tag/0.18.3"><code>0.18.3</code></a> 的 QMK 教學，僅作爲參考保留。</p>
<p><a href="/posts/diyqmkkeyboard-edit-qmk/">最新版的 QMK 教學</a>。</p>
<span id="more"></span>

<p>如果你因爲某些原因需要使用舊版 QMK 的話，可以使用下面的方法來切換 QMK 版本（需要先安裝好 QMK MSYS 環境）。</p>
<ol>
<li>打開 QMK MSYS</li>
<li>執行 <code>qmk cd</code></li>
<li>執行 <code>git fetch --all --tags --prune</code></li>
<li>執行 <code>git checkout tags/0.18.3</code></li>
</ol>
<hr>
<p>在<a href="/posts/diyqmkkeyboard-1/">上一篇文章</a>中已經完成鍵盤的 Layout，這篇文章將會接續<a href="/posts/diyqmkkeyboard-0/#%E8%A3%BD%E4%BD%9C%E6%AD%A5%E9%A9%9F">製作步驟</a>的第 3 步——生成並編輯 QMK 韌體。</p>
<h1 id="自動產生韌體"><a href="#自動產生韌體" class="headerlink" title="自動產生韌體"></a>自動產生韌體</h1><p>首先使用 <a target="_blank" rel="noopener" href="https://kbfirmware.com/">Keyboard Firmware Builder</a> 來自動生成基本的 QMK 韌體，這樣就不用全部從頭開始，工具會生成基本的韌體程式。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/ruiqimao/qmkbuilder">Keyboard Firmware Builder</a> 已經有好一段時間沒更新了，它產生的韌體在較新的 QMK 版本下會有多處出錯（<code>0.18.3</code>），並且隨著 QMK 來到 <code>0.21.3</code>，此工具所產生的大多數檔案已經不適用了。</p>
</blockquote>
<h2 id="讀入鍵盤"><a href="#讀入鍵盤" class="headerlink" title="讀入鍵盤"></a>讀入鍵盤</h2><p>到 Keyboard Layout Editor 並載入你編輯好的鍵盤，複製其 <a href="/posts/diyqmkkeyboard-1/#%E8%BC%B8%E5%87%BA">raw data</a> 並貼到 Keyboard Firmware Builder 中間的文字框，按下深藍色的「Import」按鈕。</p>
<p><img src="https://1.bp.blogspot.com/-UTbRymD6jFo/Xu4uCFUmN4I/AAAAAAAACc4/Pun-2kS6qooDb3plao7F_e5sogqH_uHKQCK4BGAsYHg/s1903/%255B01%255DKeyboard%2BFirmware%2BBuilder_Import.png" alt="▲ 在 Keyboard Firmware Builder 貼上 KLE 的 Raw data"></p>
<h2 id="接線（wiring）"><a href="#接線（wiring）" class="headerlink" title="接線（Wiring）"></a>接線（Wiring）</h2><p>在標籤頁「Wiring」裡，你看到的是鍵盤的接線圖。</p>
<p>一般來說，鍵盤的按鍵數都大於微控制器的 GPIO 接腳數，所以會使用鍵盤矩陣掃描（Keyboard Matrix Scanning）技術。如果不是很懂鍵盤矩陣掃描的話，最好先找一些資料瞭解一下，這裡就不贅述。</p>
<p>在這裡設定鍵盤的接線（或者說鍵盤掃描矩陣）。點選其中一個按鍵可以設定它的鍵盤掃描矩陣的行列，還有設定二極體的方向（一般都是 Column to Row）。</p>
<p><img src="https://1.bp.blogspot.com/-9pJYrEjmaXU/Xu4uCdp4PEI/AAAAAAAACc8/p8MMZuiSBUMSpTjsN0f0Xa78Turt48kzwCK4BGAsYHg/s1903/%255B02%255DKeyboard%2BFirmware%2BBuilder_Wiring_1.png" alt="▲ 編輯接線"></p>
<p><img src="https://1.bp.blogspot.com/-Bx4OSDytWs8/Xu4uCq9KkdI/AAAAAAAACdA/8d4QLa2qTHMMXBS1Z6Fvma_u-Q5Ud22cgCK4BGAsYHg/s800/%255B03%255DKeyboard%2BFirmware%2BBuilder_Wiring_2.png" alt="▲ 點選一個按鍵後可以編輯該鍵位於掃描矩陣的行列"></p>
<h2 id="腳位（pins）"><a href="#腳位（pins）" class="headerlink" title="腳位（Pins）"></a>腳位（Pins）</h2><p>在標籤頁「Pins」裡可以設定使用的微控制器型號及其腳位。</p>
<p>首先選擇你使用的微控制器，例如用 Pro Micro 那就是「ATmega32U4」。如果這裡沒有列出你所用的微控制器器的話，那就可以先選「ATmega32U4」，等之後再手動修改。</p>
<p>如果你沒有使用微控制器的經驗，或是不知道要選哪個腳位才行，只要你的鍵盤沒有要加什麼特別的功能（如螢幕、搖桿、可條亮度的LED 或分離式鍵盤）的話，使用任何腳位都可以。如果你的鍵盤有這些需要特殊硬體功能（UART、SPI、I²C、PWM）的話，記得保留，不要被矩陣掃描佔用了。</p>
<p>當然，如果是使用現成的開發板（像是 Pro Micro）的話，記得要選有引出的接腳（開發板可能不會把微控制器的所有接腳都拉出）。</p>
<p><img src="https://1.bp.blogspot.com/-3_lDlu5GoMI/Xu4uCxknlCI/AAAAAAAACdE/4pwTfeQGe8cw8LW-L2a26VXxSf20eA3nwCK4BGAsYHg/s826/%255B04%255DKeyboard%2BFirmware%2BBuilder_Pins.png" alt="▲ 「Pins」標籤頁示意"></p>
<p>要注意的是，這裡顯示的接腳名稱是該微控制器原始的接腳名稱，可能會和開發板上的腳位號碼不同。</p>
<p>例如 Pro Micro 開發板上的 <code>D16</code> 其實是 ATmega32U4 的 <code>PB2</code>，而在「Pings」標籤頁顯示的是 <code>B2</code> 代表的是 <code>PB2</code>，設定前記得看好腳位對照圖。</p>
<p>以下圖爲例，「Pins」頁面中的 <code>D0</code> 其實是指 <code>PD0</code>（藍紫色），它也被稱爲 <code>D3</code>（綠色）。要注意你現在看到的腳位名稱到底是微控制器（藍紫色）的還是開發板（綠色）的，「Pins」頁面顯示的是微控制器的腳位名。</p>
<blockquote>
<p>PB2、PD7…的 P 是指 Port，通常以 8 或 16 腳為一個 Port。<br>P 後面的英文字為 Port 名，通常由 A 開始。再來的數字是腳位編號，通常由 0 開始。<br>所以 PB2 就代表 Port-B 的 2 號腳，也就是 Port-B 的第 3 支接腳，因為 Port-B 的第一支腳是 PB0。</p>
</blockquote>
<p><img src="https://1.bp.blogspot.com/-UqmjvTbo7Uo/Xu4yajqMXKI/AAAAAAAACeE/AEfdjtlknrcRsjSYvmRz5B0IxY4RIiQegCK4BGAsYHg/s1166/ProMicroPin.png" alt="▲ Pro Micro 腳位對應圖(取自SparkFun)"></p>
<h2 id="鍵映射（keymap）"><a href="#鍵映射（keymap）" class="headerlink" title="鍵映射（Keymap）"></a>鍵映射（Keymap）</h2><p>再來就是「Keymap」標籤頁，按鍵的功能（鍵映射）會在這裡進行設定。</p>
<p>點選一個按鍵後，可以在下方選擇該按鍵的功能（如<kbd>A</kbd>、<kbd>Ctrl</kbd>、<kbd>Enter</kbd>…等）。</p>
<p>而 QMK 也可以設定「層（Layer）」在設定按鍵的上方有個數字就是顯示目前在設定的層，透過按上下來設定不同層的按鍵。</p>
<p><img src="https://1.bp.blogspot.com/-bWzQzPwFGgI/Xu4uDJhvouI/AAAAAAAACdI/UTgEK0bLZWgvv2Sl1gTl3mLlCnSgn_RbACK4BGAsYHg/s1903/%255B05%255DKeyboard%2BFirmware%2BBuilder_Keymap_1.png" alt="▲ 「Keymap」標籤頁"></p>
<p>如果你在 Keyboard Layout Editor 有設定好各個按鍵的名稱的話，它會自動讀入按鍵的功能，如果沒有的話就需要在此手動編輯。</p>
<p>QMK 可以設定的按鍵請看說明文件：<a target="_blank" rel="noopener" href="https://docs.qmk.fm/#/keycodes?id=keycodes-overview">Keycodes Overview</a>。但你可能會發現這裡可以設定的按鍵並不完全，很多在「Keycodes Overview」裡面有的按鍵這裡都沒有。如果有你想要的按鍵，但沒有出現在選單中的話，可以先隨便選其它的按鍵，等之後再手動修改。</p>
<p>如果要使用層的功能的話，可以參考說明文件：<a target="_blank" rel="noopener" href="https://docs.qmk.fm/#/keycodes?id=layer-switching">Keycodes Overview-Layer Switching</a></p>
<blockquote>
<p>歸功於 <a target="_blank" rel="noopener" href="https://get.vial.today/">Vial</a>，QMK 鍵盤可以很方便地隨時編輯 Keymap，甚至連下載軟體都不用，所以在「Keymap」頁面你可以不用真的把它編輯成最終的樣子，可以先用個大概，等之後再用 Vial 修改。<br>但不建議完全空白，至少預設的第 0 層的每個鍵都要分配按鍵，方便未來測試。</p>
</blockquote>
<p><img src="https://1.bp.blogspot.com/-AXyTVOereYY/Xu4uDQIikrI/AAAAAAAACdM/ZKoLu2A_TsMjSCcAAJVC_-EHaGEJ9w3agCK4BGAsYHg/s800/%255B06%255DKeyboard%2BFirmware%2BBuilder_Keymap_2.png" alt="▲ 其中一種切換層的按鍵設定"></p>
<p><img src="https://1.bp.blogspot.com/-d9DCcztZXjQ/Xu4uD44T8EI/AAAAAAAACdQ/Zq8zndxEDWsZRd3Qud_NiWASE6bDZVgkwCK4BGAsYHg/s1903/%255B07%255DKeyboard%2BFirmware%2BBuilder_Keymap_3.png" alt="▲ 不同層可以設定不同的按鍵功能更"></p>
<h2 id="巨集鍵（macros）"><a href="#巨集鍵（macros）" class="headerlink" title="巨集鍵（Macros）"></a>巨集鍵（Macros）</h2><p>在「Macros」標籤頁裡，你可以設定巨集鍵功能。巨集鍵也可以等之後再用 Vial 設計。</p>
<p><img src="https://1.bp.blogspot.com/-6UmwdSv5mYk/Xu4uEFGPrgI/AAAAAAAACdU/QbZ_V0elfsM458VOkhnI7aTYoktUyzVBACK4BGAsYHg/s800/%255B08%255DKeyboard%2BFirmware%2BBuilder_Macros.png" alt="▲ 「Macros」標籤頁"></p>
<h2 id="quantum"><a href="#quantum" class="headerlink" title="Quantum"></a>Quantum</h2><p>在「Quantum」標籤頁裡，可以設定更詳細且複雜的功能。如果你不知道這是什麼的話，請不要編輯它，保持預設即可。</p>
<p><img src="https://1.bp.blogspot.com/-3JK9VPepotg/Xu4uEYvZriI/AAAAAAAACdY/I4z4ycD-A_YLnDOm35iWjq46P1dw1WPPQCK4BGAsYHg/s800/%255B09%255DKeyboard%2BFirmware%2BBuilder_Quantum.png" alt="▲ 「Quantum」標籤頁"></p>
<h2 id="設定（settings）"><a href="#設定（settings）" class="headerlink" title="設定（Settings）"></a>設定（Settings）</h2><p>在標籤頁「Settings」裡可以編輯一些其它的設定。包含名稱、Bootloader 大小、WS2812 LED 燈數量、背光等級。</p>
<p>「Save Configuration」按鈕可以下載一個 JSON 檔，裡面儲存了目前爲止的各種設定。在<a href="/posts/diyqmkkeyboard-2/#%E8%AE%80%E5%85%A5%E9%8D%B5%E7%9B%A4">一開始的頁面</a>裡，上方有個「Upload」按鈕，將此 JSON 檔傳上後就可以繼續編輯或修改該鍵盤。<strong>建議一定要儲存此 JSON 檔</strong>，且重新命名以避免與 Keyboard Layout Editor 的 JSON 搞混。</p>
<p><img src="https://1.bp.blogspot.com/-Vdfp-gzx0uQ/Xu4uEo34ilI/AAAAAAAACdc/sRvlviZR_xUQEhy6Ma0oLsFQ9c_OW50hgCK4BGAsYHg/s800/%255B10%255DKeyboard%2BFirmware%2BBuilder_Settings.png" alt="▲ 「Settings」標籤頁"></p>
<h2 id="編譯（compile）"><a href="#編譯（compile）" class="headerlink" title="編譯（Compile）"></a>編譯（Compile）</h2><p>最後一個標籤頁「Compile」可以透過「Download .hex」按鈕，讓它幫我們完成編譯的工作，並直接進行燒錄的步驟。</p>
<p>但如果你和我一樣是使用 Pro Micro 開發板的話，直接使用它編譯好的檔案可能會有問題，或是你想要修改更豐富的按鍵和其它功能的話，請按下「Download .zip」按鈕，來儲存 QMK 韌體的原始檔，準備對其手動修改與編譯。</p>
<p><img src="https://1.bp.blogspot.com/-IbmnNoxPZ-s/Xu4uE8BFvvI/AAAAAAAACdg/khQpXPgiygkaVn409H394FOvf9RN8C-iACK4BGAsYHg/s800/%255B11%255DKeyboard%2BFirmware%2BBuilder_Compile.png" alt="▲ 「Compile」標籤頁"></p>
<h1 id="手動編輯韌體"><a href="#手動編輯韌體" class="headerlink" title="手動編輯韌體"></a>手動編輯韌體</h1><p>接下來的步驟會需要編寫程式碼，請確保你的電腦裝有一個好用的文字編輯軟體（記事本？不太建議）。我自己是使用 <a target="_blank" rel="noopener" href="https://code.visualstudio.com/">Visual Studio Code</a>，或是你可以參考 <a target="_blank" rel="noopener" href="https://docs.qmk.fm/#/newbs_learn_more_resources?id=text-editor-resources">QMK 的建議</a>。</p>
<p>將 Keyboard Firmware Builder 「Compile」標籤頁下載的 <code>.zip</code> 檔解壓縮。</p>
<h2 id="修改-rules-mk"><a href="#修改-rules-mk" class="headerlink" title="修改 rules.mk"></a>修改 rules.mk</h2><p>在解壓縮資料夾 <code>\qmk_firmware\keyboards\kb\</code> 底下，找到檔案 <code>rules.mk</code>，使用你的文字編輯軟體打開它。</p>
<blockquote>
<p>此 <code>kb\</code> 資料夾就是這把鍵盤的根目錄，資料夾名稱就是此鍵盤在編譯時的名稱。如果想修改名稱的話，資料夾內的 <code>kb.h</code> 和 <code>kb.c</code> 及 <code>keymaps\default\keymap.c</code> 的 <code>#include &quot;kb.h&quot;</code> 的名稱都要統一改掉。詳細的 QMK 鍵盤資料夾結構請參考 <a target="_blank" rel="noopener" href="https://docs.qmk.fm/#/hardware_keyboard_guidelines?id=keyboard-folder-structure">Keyboard Guidelines - Keyboard Folder Structure</a>。</p>
</blockquote>
<p>我的<strong>原始</strong> <code>rules.mk</code> 長這樣（省略部分註解）：</p>
<figure class="highlight mk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MCU name</span></span><br><span class="line">MCU = atmega32u4</span><br><span class="line"></span><br><span class="line"><span class="comment"># Processor frequency.</span></span><br><span class="line">F_CPU = 16000000</span><br><span class="line"></span><br><span class="line"><span class="comment"># LUFA specific</span></span><br><span class="line"><span class="comment"># Target architecture (see library &quot;Board Types&quot; documentation).</span></span><br><span class="line">ARCH = AVR8</span><br><span class="line"></span><br><span class="line"><span class="comment"># Input clock frequency.</span></span><br><span class="line">F_USB = <span class="variable">$(F_CPU)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Interrupt driven control endpoint task(+60)</span></span><br><span class="line">OPT_DEFS += -DINTERRUPT_CONTROL_ENDPOINT</span><br><span class="line"></span><br><span class="line"><span class="comment"># Boot Section Size in *bytes*</span></span><br><span class="line">OPT_DEFS += -DBOOTLOADER_SIZE=4096</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build Options</span></span><br><span class="line">BOOTMAGIC_ENABLE ?= yes    <span class="comment"># Virtual DIP switch configuration(+1000)</span></span><br><span class="line">MOUSEKEY_ENABLE ?= yes    <span class="comment"># Mouse keys(+4700)</span></span><br><span class="line">EXTRAKEY_ENABLE ?= yes    <span class="comment"># Audio control and System control(+450)</span></span><br><span class="line">CONSOLE_ENABLE ?= no    <span class="comment"># Console for debug(+400)</span></span><br><span class="line">COMMAND_ENABLE ?= no    <span class="comment"># Commands for debug and configuration</span></span><br><span class="line">SLEEP_LED_ENABLE ?= no  <span class="comment"># Breathing sleep LED during USB suspend</span></span><br><span class="line">NKRO_ENABLE ?= yes      <span class="comment"># USB Nkey Rollover</span></span><br><span class="line">BACKLIGHT_ENABLE ?= no  <span class="comment"># Enable keyboard backlight functionality</span></span><br><span class="line">AUDIO_ENABLE ?= no</span><br><span class="line">RGBLIGHT_ENABLE ?= no</span><br></pre></td></tr></table></figure>

<h3 id="微控制器型號"><a href="#微控制器型號" class="headerlink" title="微控制器型號"></a>微控制器型號</h3><p>首先確認 <code>MCU = atmega32u4</code> 這行。請將等號右側改成你實際使用的微控制器晶片型號。例如用 Pro Micro 的話是 ATmega32U4，所以就是 <code>MCU = atmega32u4</code>；如果用的是 Raspberry Pi RP2040 的話就是 <code>MCU = RP2040</code>。</p>
<p>QMK 支援的晶片型號可以參考 <a target="_blank" rel="noopener" href="https://docs.qmk.fm/#/compatible_microcontrollers">Compatible Microcontrollers</a>。</p>
<h3 id="微控制器頻率"><a href="#微控制器頻率" class="headerlink" title="微控制器頻率"></a>微控制器頻率</h3><p>再來是 <code>F_CPU = 16000000</code> 這行。請確認你的晶片的運作頻率是多少，像是 Pro Micro 的話主要有 16MHz 和 8MHz 兩種型號，要分清楚。</p>
<p>如果你用的 Pro Micro 是 8MHz 的，要將原本代表 16MHz 的 <code>F_CPU = 16000000</code> 改成 8MHz：<code>F_CPU = 8000000</code>。</p>
<p>如果你是用 RP2040 的話，可以把 <code>F_CPU = ?</code>、<code>ARCH = AVR8</code>、<code>F_USB = $(F_CPU)</code>、<code>OPT_DEFS += -DINTERRUPT_CONTROL_ENDPOINT</code> 及 <code>OPT_DEFS += -DBOOTLOADER_SIZE=4096</code> 這幾行刪除。</p>
<h3 id="選擇-bootloader"><a href="#選擇-bootloader" class="headerlink" title="選擇 Bootloader"></a>選擇 Bootloader</h3><p>然後要選擇 Bootloader 種類，這個部分原本的 <code>rules.mk</code> 裡面沒有，要自己加入。你可以把它加在<code>F_CPU = ?</code> 的下面（位置其實沒什麼差別）。要加入的內容為：</p>
<figure class="highlight mk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Bootloader selection</span></span><br><span class="line"><span class="comment">#   Pro Micro    caterina</span></span><br><span class="line"><span class="comment">#   RP2040       rp2040</span></span><br><span class="line"><span class="comment">#   Teensy       halfkay</span></span><br><span class="line"><span class="comment">#   Atmel DFU    atmel-dfu</span></span><br><span class="line"><span class="comment">#   QMK DFU      qmk-dfu</span></span><br><span class="line"><span class="comment">#   LUFA DFU     lufa-dfu</span></span><br><span class="line"><span class="comment">#   ATmega328P   usbasploader</span></span><br><span class="line">BOOTLOADER = ?</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">微控制器&#x2F;開發板</th>
<th align="left">Bootloader</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Pro Micro</td>
<td align="left"><code>caterina</code></td>
</tr>
<tr>
<td align="center">RP2040</td>
<td align="left"><code>rp2040</code></td>
</tr>
<tr>
<td align="center">Teensy</td>
<td align="left"><code>halfkay</code></td>
</tr>
<tr>
<td align="center">Atmel DFU</td>
<td align="left"><code>atmel-dfu</code></td>
</tr>
<tr>
<td align="center">LUFA DFU</td>
<td align="left"><code>lufa-dfu</code></td>
</tr>
<tr>
<td align="center">QMK DFU</td>
<td align="left"><code>qmk-dfu</code></td>
</tr>
<tr>
<td align="center">ATmega328P</td>
<td align="left"><code>usbasploader</code></td>
</tr>
</tbody></table>
<p>至於 <code>BOOTLOADER = ?</code> 這行，請依照你的晶片去做選擇。例如是用 Teensy 開發板的話，就是打 <code>BOOTLOADER = halfkay</code>；Pro Micro 是 <code>BOOTLOADER = caterina</code>；RP2040 是 <code>BOOTLOADER = rp2040</code>。</p>
<p>QMK 支援的微控制器和 Bootloader 很多，如果是上面沒有寫到的話，請自行參考 QMK 文件。更詳細的說明可以看 <a target="_blank" rel="noopener" href="https://docs.qmk.fm/#/flashing?id=flashing-instructions-and-bootloader-information">Flashing Instructions and Bootloader Information</a> 。</p>
<blockquote>
<p>我以前在這一步卡了好久，上網找問題找了好久才發現這個地方要注意。</p>
</blockquote>
<h3 id="其它功能"><a href="#其它功能" class="headerlink" title="其它功能"></a>其它功能</h3><p><code>rules.mk</code> 底下還有一段 Build Options：</p>
<figure class="highlight mk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build Options</span></span><br><span class="line"><span class="comment">#   comment out to disable the options.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">BOOTMAGIC_ENABLE ?= yes    <span class="comment"># Virtual DIP switch configuration(+1000)</span></span><br><span class="line">MOUSEKEY_ENABLE ?= yes    <span class="comment"># Mouse keys(+4700)</span></span><br><span class="line">EXTRAKEY_ENABLE ?= yes    <span class="comment"># Audio control and System control(+450)</span></span><br><span class="line">CONSOLE_ENABLE ?= no    <span class="comment"># Console for debug(+400)</span></span><br><span class="line">COMMAND_ENABLE ?= no    <span class="comment"># Commands for debug and configuration</span></span><br><span class="line">SLEEP_LED_ENABLE ?= no  <span class="comment"># Breathing sleep LED during USB suspend</span></span><br><span class="line">NKRO_ENABLE ?= yes      <span class="comment"># USB Nkey Rollover</span></span><br><span class="line">BACKLIGHT_ENABLE ?= no  <span class="comment"># Enable keyboard backlight functionality</span></span><br><span class="line">AUDIO_ENABLE ?= no</span><br><span class="line">RGBLIGHT_ENABLE ?= no</span><br></pre></td></tr></table></figure>

<p>這邊可以啓用&#x2F;禁用一些特定的功能，可以參考 <a target="_blank" rel="noopener" href="https://docs.qmk.fm/#/config_options?id=feature-options">Feature Options</a> 來瞭解各個功能。</p>
<p>另外，如果你使用的是 ATmega32U4 的話，爲了儘可能地降低最終韌體的大小，可以加入 <code>LTO_ENABLE = yes</code>，詳細可以參考 <a target="_blank" rel="noopener" href="https://docs.qmk.fm/#/squeezing_avr?id=rulesmk-settings">Squeezing Space from AVR</a>。</p>
<h3 id="修改完成"><a href="#修改完成" class="headerlink" title="修改完成"></a>修改完成</h3><p><code>rules.mk</code> 的部分大概就是這些，裡面還有更多的設定可以調整，這裡就不細講了。</p>
<p><strong>修改完</strong>的 <code>rules.mk</code> 長這樣（省略部分註解）：</p>
<figure class="highlight mk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 【Pro Micro (ATmega32U4) 範例 rules.mk】</span></span><br><span class="line"><span class="comment"># MCU name</span></span><br><span class="line">MCU = atmega32u4</span><br><span class="line"></span><br><span class="line"><span class="comment"># Processor frequency.</span></span><br><span class="line">F_CPU = 8000000</span><br><span class="line"></span><br><span class="line"><span class="comment"># Bootloader selection</span></span><br><span class="line">BOOTLOADER = caterina</span><br><span class="line"></span><br><span class="line"><span class="comment"># LUFA specific</span></span><br><span class="line"><span class="comment"># Target architecture (see library &quot;Board Types&quot; documentation).</span></span><br><span class="line">ARCH = AVR8</span><br><span class="line"></span><br><span class="line"><span class="comment"># Input clock frequency.</span></span><br><span class="line">F_USB = <span class="variable">$(F_CPU)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Interrupt driven control endpoint task(+60)</span></span><br><span class="line">OPT_DEFS += -DINTERRUPT_CONTROL_ENDPOINT</span><br><span class="line"></span><br><span class="line"><span class="comment"># Boot Section Size in *bytes*</span></span><br><span class="line">OPT_DEFS += -DBOOTLOADER_SIZE=4096</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build Options</span></span><br><span class="line">BOOTMAGIC_ENABLE ?= yes    <span class="comment"># Virtual DIP switch configuration(+1000)</span></span><br><span class="line">MOUSEKEY_ENABLE ?= yes    <span class="comment"># Mouse keys(+4700)</span></span><br><span class="line">EXTRAKEY_ENABLE ?= yes    <span class="comment"># Audio control and System control(+450)</span></span><br><span class="line">CONSOLE_ENABLE ?= no    <span class="comment"># Console for debug(+400)</span></span><br><span class="line">COMMAND_ENABLE ?= no    <span class="comment"># Commands for debug and configuration</span></span><br><span class="line">SLEEP_LED_ENABLE ?= no  <span class="comment"># Breathing sleep LED during USB suspend</span></span><br><span class="line">NKRO_ENABLE ?= yes      <span class="comment"># USB Nkey Rollover</span></span><br><span class="line">BACKLIGHT_ENABLE ?= no  <span class="comment"># Enable keyboard backlight functionality</span></span><br><span class="line">AUDIO_ENABLE ?= no</span><br><span class="line">RGBLIGHT_ENABLE ?= no</span><br><span class="line"></span><br><span class="line"><span class="comment">#LTO_ENABLE = yes       # Link time optimization, enable to reduce the compiled size of firmware.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight mk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 【RP2040 範例 rules.mk】</span></span><br><span class="line"><span class="comment"># MCU name</span></span><br><span class="line">MCU = RP2040</span><br><span class="line"></span><br><span class="line"><span class="comment"># Bootloader selection</span></span><br><span class="line">BOOTLOADER = rp2040</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build Options</span></span><br><span class="line">BOOTMAGIC_ENABLE ?= yes    <span class="comment"># Virtual DIP switch configuration(+1000)</span></span><br><span class="line">MOUSEKEY_ENABLE ?= yes    <span class="comment"># Mouse keys(+4700)</span></span><br><span class="line">EXTRAKEY_ENABLE ?= yes    <span class="comment"># Audio control and System control(+450)</span></span><br><span class="line">CONSOLE_ENABLE ?= no    <span class="comment"># Console for debug(+400)</span></span><br><span class="line">COMMAND_ENABLE ?= no    <span class="comment"># Commands for debug and configuration</span></span><br><span class="line">SLEEP_LED_ENABLE ?= no  <span class="comment"># Breathing sleep LED during USB suspend</span></span><br><span class="line">NKRO_ENABLE ?= yes      <span class="comment"># USB Nkey Rollover</span></span><br><span class="line">BACKLIGHT_ENABLE ?= no  <span class="comment"># Enable keyboard backlight functionality</span></span><br><span class="line">AUDIO_ENABLE ?= no</span><br><span class="line">RGBLIGHT_ENABLE ?= no</span><br></pre></td></tr></table></figure>

<h2 id="修改-config-h"><a href="#修改-config-h" class="headerlink" title="修改 config.h"></a>修改 config.h</h2><p>在鍵盤路徑下有個 <code>config.h</code> 檔案，裡面可以修改腳位、USB 資訊等。使用文字編輯軟體打開它。</p>
<h3 id="修改-usb-資訊"><a href="#修改-usb-資訊" class="headerlink" title="修改 USB 資訊"></a>修改 USB 資訊</h3><p>在 <code>config.h</code> 裡有以下這幾行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USB Device descriptor parameter */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VENDOR_ID       0xFEED</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRODUCT_ID      0x6060</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEVICE_VER      0x0001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MANUFACTURER    qmkbuilder</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRODUCT         keyboard</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>vendor_id</code>：USB VID。可以保持不變</li>
<li><code>product_id</code>：USB PID。可以保持不變</li>
<li><code>DEVEICE_VER</code>：裝置版本。可以保持不變</li>
<li><code>MANUFACTURER</code>：製造商&#x2F;開發者</li>
<li><code>PRODUCT</code>：鍵盤的名稱</li>
</ul>
<p><em><strong>請注意</strong></em>，原本有一行 <code>#define DESCRIPTION</code>，但新版的 QMK 已經不使用，請將此行刪除。</p>
<p>例如我可以改成：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> VENDOR_ID       0x5A69  <span class="comment">/* ASCII &quot;Zi&quot; */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRODUCT_ID      0xE000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEVICE_VER      0x0001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MANUFACTURER    ZiTe</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRODUCT         KeyPad</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>USB VID 與 PID 是 USB 設備的識別號，正常來說是要向 USB 協會申請&#x2F;購買，但是我們只是要自己做鍵盤的話通常都自行設定就好。要注意的是，如果一臺電腦同時接了多個相同 VID 和 PID 的裝置，那這些裝置可能無法運作。</p>
</blockquote>
<h3 id="修改腳位"><a href="#修改腳位" class="headerlink" title="修改腳位"></a>修改腳位</h3><p>在 <code>config.h</code> 裡有以下這幾行，用來修改鍵盤矩陣掃描所用的微控制器腳位。請注意，這裡的腳位名稱是微控制本身的腳位，不是開發板上的，可以回顧一下<a href="/posts/diyqmkkeyboard-2/#%E8%85%B3%E4%BD%8Dpins">腳位（Pins）</a>內的說明。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* key matrix pins */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATRIX_ROW_PINS &#123; B0, B1, B2, B3, B4 &#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATRIX_COL_PINS &#123; B5, B6, B7, C0 &#125;</span></span><br></pre></td></tr></table></figure>

<p>如果你用的是 RP2040 的話，腳位名稱使用的是 <code>GPx</code>，可以參考 <a target="_blank" rel="noopener" href="https://docs.qmk.fm/#/platformdev_rp2040?id=pin-nomenclature">RP2040 Pin nomenclature</a>。例如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MATRIX_ROW_PINS &#123; GP0, GP1, GP2, GP3, GP4 &#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATRIX_COL_PINS &#123; GP10, GP11, GP12, GP13 &#125;</span></span><br></pre></td></tr></table></figure>

<p><em><strong>請注意</strong></em>，原本還有 <code>#define UNUSED_PINS</code>，但是新版的 QMK 已經不使用，請將該行刪除。詳見 <a target="_blank" rel="noopener" href="https://www.reddit.com/r/olkb/comments/wznmtn/qmk_breaking_changes_2022_august_27_changelog/">QMK Breaking Changes - 2022 August 27 Changelog</a> 及 <a target="_blank" rel="noopener" href="https://github.com/qmk/qmk_firmware/pull/17931">Pull Request #17931 · qmk&#x2F;qmk_firmware</a>。</p>
<h3 id="鍵盤矩陣大小"><a href="#鍵盤矩陣大小" class="headerlink" title="鍵盤矩陣大小"></a>鍵盤矩陣大小</h3><p>鍵盤矩陣的大小可以在此修改。Row 與 Colume 的數量要和設定的腳位數量一致：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* key matrix size */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATRIX_ROWS 5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATRIX_COLS 4</span></span><br></pre></td></tr></table></figure>

<h3 id="防彈跳"><a href="#防彈跳" class="headerlink" title="防彈跳"></a>防彈跳</h3><p><em><strong>請注意</strong></em>，原本的防彈跳是使用：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Set 0 if debouncing isn&#x27;t needed */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEBOUNCING_DELAY 5</span></span><br></pre></td></tr></table></figure>

<p>但新版的 QMK 將 <code>DEBOUNCING_DELAY</code> 改成 <code>DEBOUNCE</code>，所以要將該行修改成：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Set 0 if debouncing isn&#x27;t needed */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEBOUNCE 5</span></span><br></pre></td></tr></table></figure>

<h3 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h3><p><em><strong>請注意</strong></em>，原本的 <code>config.h</code> 內有：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* prevent stuck modifiers */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PREVENT_STUCK_MODIFIERS</span></span><br></pre></td></tr></table></figure>

<p>但新版的 QMK 已經不使用 <code>PREVENT_STUCK_MODIFIERS</code>，請將該行刪除。詳見 <a target="_blank" rel="noopener" href="https://github.com/qmk/qmk_firmware/issues/2518">Issue #2518 · qmk&#x2F;qmk_firmware</a>。</p>
<p>另外，原本的 <code>config.h</code>（及其它 <code>.h</code> 檔案） 的 Include Guard 是使用傳統的預處理器寫法，你可以將其改成較先進的 <code>#pragma once</code>。例如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 舊 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CONFIG_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_H</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>改成以下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 新 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果你沒有改用 <code>#pragma once</code>，且你有更改鍵盤的名稱（不是 <code>#define PRODUCT</code> 的名稱，是預設爲 kb 的<a href="/posts/diyqmkkeyboard-2/#%E4%BF%AE%E6%94%B9-rulesmk">資料夾與檔案名稱</a>），那原本的 <code>kb.h</code> 被修改成 <code>my_new_keyboard.h</code> 後，其內的 <code>KB_H</code> 要修改成 <code>MY_NEW_KEYBOARD_H</code>，即這裡也要改成你鍵盤的名稱且習慣全大寫。當然，如果你熟悉 C 的話可以用你喜歡的方式。</p>
</blockquote>
<p>如果你使用的是 RP2040 的話，可以在 <code>config.h</code> 中加入：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> RP2040_BOOTLOADER_DOUBLE_TAP_RESET</span></span><br></pre></td></tr></table></figure>

<p>這樣就可以啓用 <a target="_blank" rel="noopener" href="https://docs.qmk.fm/#/platformdev_rp2040?id=double-tap">Double-tap Reset</a> 功能，未來燒錄時會比較方便。</p>
<h3 id="修改完成-1"><a href="#修改完成-1" class="headerlink" title="修改完成"></a>修改完成</h3><p>修改完成的 <code>config.h</code> 範例：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;config_common.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USB Device descriptor parameter */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VENDOR_ID       0x5A69  <span class="comment">/* ASCII &quot;Zi&quot; */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRODUCT_ID      0xE000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEVICE_VER      0x0001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MANUFACTURER    ZiTe</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRODUCT         KeyPad</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* key matrix size */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATRIX_ROWS 5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATRIX_COLS 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* key matrix pins */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATRIX_ROW_PINS &#123; B0, B1, B2, B3, B4 &#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATRIX_COL_PINS &#123; B5, B6, B7, C0 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* COL2ROW or ROW2COL */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DIODE_DIRECTION COL2ROW</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* number of backlight levels */</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> BACKLIGHT_PIN</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BACKLIGHT_LEVELS 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Set 0 if debouncing isn&#x27;t needed */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEBOUNCE 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Mechanical locking support. Use KC_LCAP, KC_LNUM or KC_LSCR instead in keymap */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOCKING_SUPPORT_ENABLE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Locking resynchronize hack */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOCKING_RESYNC_ENABLE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* key combination for command */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IS_COMMAND() ( \</span></span><br><span class="line"><span class="meta">    keyboard_report-&gt;mods == (MOD_BIT(KC_LSHIFT) | MOD_BIT(KC_RSHIFT)) \</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> RGB_DI_PIN</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RGBLIGHT_ANIMATIONS</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RGBLED_NUM 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RGBLIGHT_HUE_STEP 8</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RGBLIGHT_SAT_STEP 8</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RGBLIGHT_VAL_STEP 8</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h2 id="修改-keymap-c"><a href="#修改-keymap-c" class="headerlink" title="修改 keymap.c"></a>修改 keymap.c</h2><p>在<code>\kb\keymaps\default\</code> 底下，有個 <code>keymap.c</code> 檔案，這是用來指定鍵映射的，使用文字編輯軟體打開它。</p>
<h3 id="刪除-even"><a href="#刪除-even" class="headerlink" title="刪除 even"></a>刪除 even</h3><p>首先找到 <code>const macro_t *action_get_macro(keyrecord_t *record, uint8_t id, uint8_t opt)</code> 這一段，將其用 <code>//</code> 註解掉（或直接刪除），也就是把該區塊變成：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const macro_t *action_get_macro(keyrecord_t *record, uint8_t id, uint8_t opt) &#123;</span></span><br><span class="line"><span class="comment">//   keyevent_t event = record-&gt;event;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   switch (id) &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   return MACRO_NONE;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<p>這邊預設會造成編譯錯誤 <code>unused variable &#39;event&#39; [-Werror=unusued-variable] keyevent_t event = record-&gt;event;</code>，當然，如果你懂 C 的話就知道這是什麼意思，可以透過其它你自己喜歡的方式解決。可以參考 <a target="_blank" rel="noopener" href="https://www.reddit.com/r/olkb/comments/72f66p/qmk_issue_error_unused_variable_event/">QMK issue - error: unused variable ‘event’ [-Werror&#x3D;unused-variable] : olkb</a>。</p>
<h3 id="改按鍵映射"><a href="#改按鍵映射" class="headerlink" title="改按鍵映射"></a>改按鍵映射</h3><p>在<a href="/posts/diyqmkkeyboard-2/#%E9%8D%B5%E6%98%A0%E5%B0%84keymap">先前的段落</a>有提到 Keyboard Firmware Builder 裡的「Keymap」標籤頁可以設定的按鍵並不完全，如果想要自行修改的話就要再此編輯。</p>
<p>在 <code>keymap.c</code> 裡你會看到許多像是這樣的內容：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">KEYMAP(</span><br><span class="line">    KC_NLCK, KC_SLSH, KC_ASTR, KC_MINS,</span><br><span class="line">    KC_P7,   KC_P8,   KC_F9,</span><br><span class="line">    KC_P4,   KC_P5,   KC_P6,   KC_PLUS,</span><br><span class="line">    KC_P1,   KC_P2,   KC_P3,</span><br><span class="line">    KC_P0,   MO(<span class="number">1</span>),   KC_PENT),</span><br></pre></td></tr></table></figure>

<p>這些就代表了鍵盤各個鍵位的按鍵功能。像是 <code>KC_P7</code> 代表了 <kbd>Numpad7</kbd>（數字鍵盤的 7），而詳細的按鍵名稱請參考 QMK 的說明文件：<a target="_blank" rel="noopener" href="https://docs.qmk.fm/#/keycodes?id=keycodes-overview">Keycodes Overview</a>。</p>
<p>你所需要做的就是把該按鍵的代號（如 <code>KC_P7</code>）放在對的位置就好了。而每一塊 <code>KEYMAP(...)</code> 代表的是一層，最上面的是第 0 層，往下是第 1、2…n 層。</p>
<blockquote>
<p>新版的 QMK 習慣使用 <code>LAYOUT</code> 爲名而非 <code>KEYMAP</code>，你可以將 <code>keymap.c</code> 及 <code>kb.h</code> 內的 <code>KEYMAP</code> 都改成 <code>LAYOUT</code>。但是不修改應該還是可以完成編譯。</p>
</blockquote>
<h1 id="結語"><a href="#結語" class="headerlink" title="結語"></a>結語</h1><p>到此為止，QMK 韌體原始檔的基本編輯就完成了，接下來就要準備進行編譯。</p>
<p>這一篇的內容可能比較難，且 QMK 也一直再更新，如果有我寫得不夠清楚或是有誤的地方，歡迎提出。</p>
<h1 id="相關網站及參考資料"><a href="#相關網站及參考資料" class="headerlink" title="相關網站及參考資料"></a>相關網站及參考資料</h1><ul>
<li><a href="/posts/diyqmkkeyboard-0/#%E6%95%99%E5%AD%B8%E6%96%87%E5%88%97%E8%A1%A8">本 QMK 教學系列文列表</a></li>
<li><a target="_blank" rel="noopener" href="https://kbfirmware.com/">Keyboard Firmware Builder</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.sparkfun.com/tutorials/qwiic-pro-micro-usb-c-atmega32u4-hookup-guide/all">Qwiic Pro Micro USB-C (ATmega32U4) Hookup Guide - SparkFun Learn</a></li>
<li><a target="_blank" rel="noopener" href="https://www.reddit.com/r/olkb/comments/wznmtn/qmk_breaking_changes_2022_august_27_changelog/">QMK Breaking Changes - 2022 August 27 Changelog : olkb</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/qmk/qmk_firmware/pull/17931">Remove <code>UNUSED_PINS</code> by tzarc · Pull Request #17931 · qmk&#x2F;qmk_firmware</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/qmk/qmk_firmware/issues/2518">PREVENT_STUCK_MODIFIERS should be the default · Issue #2518 · qmk&#x2F;qmk_firmware</a></li>
<li><a target="_blank" rel="noopener" href="https://www.reddit.com/r/olkb/comments/72f66p/qmk_issue_error_unused_variable_event/">QMK issue - error: unused variable ‘event’ [-Werror&#x3D;unused-variable] : olkb</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/qmk/qmk_firmware/issues/3091">RESET key not working with pro micro #3091</a></li>
<li><a target="_blank" rel="noopener" href="https://www.reddit.com/r/olkb/comments/8sxgzb/replace_pro_micro_bootloader_with_qmk_dfu/">Replace Pro Micro bootloader with QMK DFU</a></li>
<li>QMK相關<ul>
<li><a target="_blank" rel="noopener" href="https://qmk.fm/">QMK 官方網站</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.qmk.fm/#/">QMK 官方文件</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/qmk/qmk_firmware">QMK 的 GitHub</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>本文最早發佈於 2020-06-21，於 2023 重新編排並更新內容。</p>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/diyqmkkeyboard-kle/" rel="prev" title="[自製QMK鍵盤-1] 編輯鍵盤佈局 (Layout)">
                  <i class="fa fa-angle-left"></i> [自製QMK鍵盤-1] 編輯鍵盤佈局 (Layout)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/kicanvas-intro/" rel="next" title="KiCanvas——線上預覽KiCAD電路圖">
                  KiCanvas——線上預覽KiCAD電路圖 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







  <p style="text-align: center;color: #a3a3a3;font-size: 14px;margin-top: 60px;">留言可能不會立即顯示。若過了幾天仍未出現，請 <a href="mailto:honmonoh@gmail.com">Email</a> 聯繫：）</p>
    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" title="本網站所有內容除特別聲明外，均採用創用CC 姓名標示-非商業性-禁止改作授權。
    分享時請註明作者及出處。" style="border-bottom: 0;">
      <img src="https://i.creativecommons.org/l/by-nc-nd/3.0/80x15.png" style="display: unset;">
    </a>
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">ZiTe</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  



  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"zite-honmonoh","count":false,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
